<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢–∞–π–º–µ—Ä –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#0f0c29 0%,#302b63 50%,#24243e 100%);color:#fff;min-height:100vh;padding:clamp(10px,3vw,20px);transition:padding .3s}body.fullscreen{padding:0}.container{max-width:900px;margin:0 auto;background:rgba(255,255,255,.03);backdrop-filter:blur(20px);border-radius:24px;padding:clamp(20px,4vw,40px);box-shadow:0 20px 60px rgba(0,0,0,.4),0 0 1px rgba(255,255,255,.1) inset;border:1px solid rgba(255,255,255,.05);transition:all .3s}body.fullscreen .container{max-width:100%;height:100vh;border-radius:0;display:flex;flex-direction:column;padding:clamp(15px,2vw,25px)}.header{display:flex;align-items:center;gap:15px;margin-bottom:clamp(15px,3vw,25px)}h1{flex:1;font-size:clamp(1.5rem,4vw,2.2rem);font-weight:700;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center}.subtitle{text-align:center;color:#a0aec0;margin-bottom:clamp(20px,4vw,30px);font-size:clamp(.85rem,2vw,1rem)}.fullscreen-btn{background:rgba(102,126,234,.2);border:1px solid rgba(102,126,234,.3);color:#667eea;border-radius:12px;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.3rem;transition:all .3s}.fullscreen-btn:hover{background:rgba(102,126,234,.3);transform:scale(1.05)}.control-panel{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.05);border-radius:20px;padding:clamp(15px,3vw,25px);margin-bottom:clamp(20px,4vw,30px);display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:clamp(10px,2vw,15px)}.control-group{display:flex;flex-direction:column;gap:8px}label{font-size:.85rem;color:#a0aec0;font-weight:500}select,button{padding:12px 16px;border:1px solid rgba(255,255,255,.1);border-radius:12px;font-size:.95rem;cursor:pointer;transition:all .3s;font-family:inherit}select{background:rgba(255,255,255,.05);color:#fff}select:hover,select:focus{background:rgba(255,255,255,.08);border-color:rgba(102,126,234,.5);outline:0}.action-btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;font-weight:600;border:none;position:relative;overflow:hidden}.action-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s}.action-btn:hover::before{left:100%}.action-btn:hover{transform:translateY(-2px);box-shadow:0 5px 20px rgba(102,126,234,.4)}.action-btn:disabled{background:rgba(255,255,255,.1);cursor:not-allowed;transform:none;box-shadow:none}.timer-display{background:linear-gradient(135deg,rgba(102,126,234,.1) 0%,rgba(118,75,162,.1) 100%);border:2px solid rgba(102,126,234,.3);border-radius:24px;padding:clamp(20px,5vw,40px);margin-bottom:clamp(20px,4vw,30px);text-align:center;position:relative;overflow:hidden}.timer-display::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(102,126,234,.1) 0%,transparent 70%);animation:pulse 4s ease-in-out infinite}@keyframes pulse{0%,100%{transform:scale(1);opacity:.5}50%{transform:scale(1.1);opacity:.8}}body.fullscreen .timer-display{flex:1;display:flex;flex-direction:column;justify-content:center}.time{font-size:clamp(3.5rem,12vw,6rem);font-weight:800;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:clamp(10px,2vw,15px);position:relative;z-index:1;letter-spacing:-.02em}.exercise-info{font-size:clamp(1.3rem,3.5vw,2rem);font-weight:600;color:#e2e8f0;margin-bottom:clamp(8px,2vw,12px);min-height:clamp(40px,8vw,60px);position:relative;z-index:1}.phase-info{font-size:clamp(1rem,2.5vw,1.3rem);color:#cbd5e0;margin-bottom:8px;position:relative;z-index:1}.circle-info{font-size:clamp(.95rem,2vw,1.15rem);color:#a0aec0;position:relative;z-index:1}.exercise-details{margin-top:clamp(15px,3vw,25px);padding:clamp(12px,2.5vw,18px);background:rgba(0,0,0,.2);border-radius:16px;border-left:3px solid #667eea;position:relative;z-index:1}.next-exercise{font-size:clamp(1rem,2.5vw,1.25rem);color:#cbd5e0;margin-bottom:10px;display:none}.next-exercise.show{display:block}.next-exercise span{font-weight:600;color:#667eea}.technique{font-size:clamp(.85rem,2vw,1rem);color:#a0aec0;line-height:1.5;font-style:italic}.hint-toggle{background:rgba(102,126,234,.15);color:#667eea;border:1px solid rgba(102,126,234,.3);border-radius:8px;padding:8px 16px;font-size:.85rem;cursor:pointer;margin-top:12px;transition:all .3s}.hint-toggle:hover{background:rgba(102,126,234,.25)}.status{font-size:clamp(1.1rem,2.5vw,1.4rem);text-align:center;margin-top:clamp(15px,3vw,20px);min-height:30px;font-weight:500}.workout-list{background:rgba(0,0,0,.2);border-radius:20px;padding:clamp(15px,3vw,25px);margin-top:clamp(20px,4vw,30px)}body.fullscreen .workout-list{display:none}.workout-list h3{color:#cbd5e0;margin-bottom:15px;font-size:clamp(1.1rem,2.5vw,1.3rem);font-weight:600}.exercise-item{padding:12px 16px;margin:8px 0;background:rgba(255,255,255,.03);border-radius:12px;display:flex;justify-content:space-between;align-items:center;transition:all .3s;cursor:pointer;border:1px solid transparent;font-size:clamp(.9rem,2vw,1rem)}.exercise-item:hover{background:rgba(255,255,255,.06);border-color:rgba(102,126,234,.3);transform:translateX(4px)}.exercise-item.active{background:rgba(102,126,234,.2);border-color:#667eea;transform:translateX(8px)}.exercise-item.completed{opacity:.5;color:#718096}.volume-control{display:flex;align-items:center;gap:10px;grid-column:1/-1}.volume-control input{flex:1;height:6px;border-radius:3px;background:rgba(255,255,255,.1);outline:0;-webkit-appearance:none}.volume-control input::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:#667eea;cursor:pointer}.keep-alive-info{position:fixed;bottom:20px;right:20px;background:rgba(0,0,0,.9);backdrop-filter:blur(10px);padding:10px 16px;border-radius:12px;font-size:.85rem;display:none;z-index:1000;border:1px solid rgba(102,126,234,.3);color:#cbd5e0}.keep-alive-info.active{display:block}.keep-alive-info.wakelock{border-color:#48bb78;color:#68d391}@media (max-width:768px){.control-panel{grid-template-columns:1fr}.volume-control{grid-column:1}}@media (max-height:700px) and (orientation:landscape){body.fullscreen .container{padding:15px}body.fullscreen .timer-display{padding:15px}.exercise-details{display:none}}
</style>
</head>
<body>
<div class="keep-alive-info" id="keepAliveInfo">üîã –≠–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω</div>
<div class="container">
<div class="header">
<h1>üî• –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ñ–∏—Ä–æ—Å–∂–∏–≥–∞—Ç–µ–ª—å</h1>
<button class="fullscreen-btn" id="fullscreenBtn" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º">‚õ∂</button>
</div>
<div class="subtitle">–¢–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è–º–∏</div>
<div class="control-panel">
<div class="control-group">
<label for="programSelect">–ü—Ä–æ–≥—Ä–∞–º–º–∞:</label>
<select id="programSelect"><option value="">–ó–∞–≥—Ä—É–∑–∏—Ç—å...</option></select>
</div>
<div class="control-group">
<button class="action-btn" id="loadProgramBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
</div>
<div class="control-group">
<label for="circles">–ö—Ä—É–≥–æ–≤:</label>
<select id="circles">
<option value="3">3 –∫—Ä—É–≥–∞</option><option value="4">4 –∫—Ä—É–≥–∞</option>
<option value="5" selected>5 –∫—Ä—É–≥–æ–≤</option><option value="6">6 –∫—Ä—É–≥–æ–≤</option>
<option value="7">7 –∫—Ä—É–≥–æ–≤</option><option value="8">8 –∫—Ä—É–≥–æ–≤</option>
<option value="9">9 –∫—Ä—É–≥–æ–≤</option>
</select>
</div>
<button class="action-btn" id="startBtn">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
<button class="action-btn" id="pauseBtn" disabled>‚è∏ –ü–∞—É–∑–∞</button>
<button class="action-btn" id="resetBtn">üîÑ –°–±—Ä–æ—Å</button>
<div class="volume-control">
<span>üîä</span><input type="range" id="volume" min="0" max="1" step="0.1" value="1">
<span id="volumeValue">100%</span>
</div>
</div>
<div class="timer-display">
<div class="time" id="timer">45</div>
<div class="exercise-info" id="exerciseName">–ì–æ—Ç–æ–≤ –∫ –Ω–∞—á–∞–ª—É</div>
<div class="phase-info" id="phase">–†–∞–±–æ—Ç–∞</div>
<div class="circle-info" id="circleInfo">–ö—Ä—É–≥: 1/5</div>
<div class="exercise-details">
<div class="next-exercise" id="nextExercise">–î–∞–ª–µ–µ: <span id="nextExerciseName">...</span></div>
<div class="technique" id="technique">–ù–∞–∂–º–∏—Ç–µ –°—Ç–∞—Ä—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
<button class="hint-toggle" id="hintToggle">–û–∑–≤—É—á–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É</button>
</div>
</div>
<div class="status" id="status">–ì–æ—Ç–æ–≤ –∫ –Ω–∞—á–∞–ª—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
<div class="workout-list">
<h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ –∫—Ä—É–≥–µ:</h3>
<div id="exercisesList"></div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
let ex=[{n:"–ë—ã—Å—Ç—Ä—ã–π –±–µ–≥ –Ω–∞ –º–µ—Å—Ç–µ —Å –∑–∞—Ö–ª—ë—Å—Ç–æ–º –≥–æ–ª–µ–Ω–∏ (High Knees + Heel Kicks)",t:"–í—Å—Ç–∞–Ω—å—Ç–µ –ø—Ä—è–º–æ, –Ω–æ–≥–∏ –Ω–∞ —à–∏—Ä–∏–Ω–µ –ø–ª–µ—á. –ë–µ–≥–∏—Ç–µ –Ω–∞ –º–µ—Å—Ç–µ, –ø–æ–ø–µ—Ä–µ–º–µ–Ω–Ω–æ –≤—ã—Å–æ–∫–æ –ø–æ–¥–Ω–∏–º–∞—è –∫–æ–ª–µ–Ω–∏ (–¥–æ —É—Ä–æ–≤–Ω—è —Ç–∞–∑–∞ –∏–ª–∏ –≤—ã—à–µ) –∏ –∑–∞—Ç–µ–º —É–¥–∞—Ä—è—è –ø—è—Ç–∫–∞–º–∏ –ø–æ —è–≥–æ–¥–∏—Ü–∞–º. –î–µ—Ä–∂–∏—Ç–µ –∫–æ—Ä–ø—É—Å –ø—Ä—è–º–æ, —Ä–∞–±–æ—Ç–∞–π—Ç–µ —Ä—É–∫–∞–º–∏ –∫–∞–∫ –ø—Ä–∏ –±–µ–≥–µ. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤—ã—Å–æ–∫–∏–π —Ç–µ–º–ø, —Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Å–¥–≤–∏–≥–∞—Ç—å—Å—è —Å –º–µ—Å—Ç–∞."},{n:"–ë–æ–∫–æ–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ä—É–∫–∞–º–∏ –ø–æ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω–µ",t:"–ü–æ–≤–∏—Å–Ω–∏—Ç–µ –Ω–∞ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω–µ –ø—Ä—è–º—ã–º —Ö–≤–∞—Ç–æ–º (–ª–∞–¥–æ–Ω–∏ –æ—Ç —Å–µ–±—è). –ù–æ–≥–∏ –º–æ–∂–Ω–æ —Å–ª–µ–≥–∫–∞ —Å–æ–≥–Ω—É—Ç—å –∏–ª–∏ —Å–∫—Ä–µ—Å—Ç–∏—Ç—å –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏. –ü–µ—Ä–µ–º–µ—â–∞–π—Ç–µ—Å—å –≤–±–æ–∫, –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ –æ—Ç–ø—É—Å–∫–∞—è –æ–¥–Ω—É —Ä—É–∫—É –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—è –µ–µ –¥–∞–ª—å—à–µ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –¥–≤–∏–∂–µ–Ω–∏—è, –∑–∞—Ç–µ–º –ø–æ–¥—Ç—è–≥–∏–≤–∞—è –≤—Ç–æ—Ä—É—é —Ä—É–∫—É."},{n:"–ë—ë—Ä–ø–∏",t:"1. –ò–∑ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å—Ç–æ—è –ø—Ä–∏—Å—è–¥—å—Ç–µ, —É–ø—Ä–∏—Ç–µ—Å—å –ª–∞–¥–æ–Ω—è–º–∏ –≤ –ø–æ–ª. 2. –ü—Ä—ã–∂–∫–æ–º –æ—Ç–±—Ä–æ—Å—å—Ç–µ –Ω–æ–≥–∏ –Ω–∞–∑–∞–¥ –≤ –ø–ª–∞–Ω–∫—É. 3. –°–¥–µ–ª–∞–π—Ç–µ –æ—Ç–∂–∏–º–∞–Ω–∏–µ. 4. –ü—Ä—ã–∂–∫–æ–º –ø–æ–¥—Ç—è–Ω–∏—Ç–µ –Ω–æ–≥–∏ –∫ —Ä—É–∫–∞–º. 5. –í—ã–ø—Ä—ã–≥–Ω–∏—Ç–µ –≤–≤–µ—Ä—Ö —Å —Ö–ª–æ–ø–∫–æ–º."},{n:"–û—Ç–∂–∏–º–∞–Ω–∏—è —Å –Ω–æ–≥–∞–º–∏ –Ω–∞ –≤–æ–∑–≤—ã—à–µ–Ω–∏–∏",t:"–ü—Ä–∏–º–∏—Ç–µ —É–ø–æ—Ä –ª—ë–∂–∞, –ø–æ—Å—Ç–∞–≤–∏–≤ –Ω–æ–≥–∏ –Ω–∞ –≤–æ–∑–≤—ã—à–µ–Ω–∏–µ. –†—É–∫–∏ –Ω–∞ –ø–æ–ª—É –ø–æ–¥ –ø–ª–µ—á–∞–º–∏. –¢–µ–ª–æ –æ–±—Ä–∞–∑—É–µ—Ç –ø—Ä—è–º—É—é –ª–∏–Ω–∏—é. –ù–∞ –≤–¥–æ—Ö–µ —Å–æ–≥–Ω–∏—Ç–µ –ª–æ–∫—Ç–∏, –æ–ø—É—Å–∫–∞—è –≥—Ä—É–¥—å –∫ –ø–æ–ª—É. –ù–∞ –≤—ã–¥–æ—Ö–µ –º–æ—â–Ω–æ –æ—Ç–æ–∂–º–∏—Ç–µ—Å—å."},{n:"–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –≤—ã–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ–º –∏ –ø–∞—É–∑–æ–π",t:"–ü–æ—Å—Ç–∞–≤—å—Ç–µ –Ω–æ–≥–∏ –Ω–∞ —à–∏—Ä–∏–Ω–µ –ø–ª–µ—á. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≥–ª—É–±–æ–∫–∏–π –ø—Ä–∏—Å–µ–¥. –í –Ω–∏–∂–Ω–µ–π —Ç–æ—á–∫–µ –∑–∞–º—Ä–∏—Ç–µ –Ω–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã. –ó–∞—Ç–µ–º –º–æ—â–Ω–æ –≤—ã–ø—Ä—ã–≥–Ω–∏—Ç–µ –≤–≤–µ—Ä—Ö. –ú—è–≥–∫–æ –ø—Ä–∏–∑–µ–º–ª–∏—Ç–µ—Å—å –∏ —Å—Ä–∞–∑—É —É—Ö–æ–¥–∏—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏—Å–µ–¥."},{n:"–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è",t:"–í–æ–∑—å–º–∏—Ç–µ—Å—å –∑–∞ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω—É —Ö–≤–∞—Ç–æ–º —à–∏—Ä–µ –ø–ª–µ—á. –ù–∞ –≤—ã–¥–æ—Ö–µ –ø–æ–¥—Ç—è–Ω–∏—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–¥–±–æ—Ä–æ–¥–æ–∫ –æ–∫–∞–∑–∞–ª—Å—è –Ω–∞–¥ –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω–æ–π. –ù–∞ –≤–¥–æ—Ö–µ –º–µ–¥–ª–µ–Ω–Ω–æ –æ–ø—É—Å—Ç–∏—Ç–µ—Å—å."},{n:"–†—É—Å—Å–∫–∏–µ —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏—è —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º –Ω–æ–≥ —á–µ—Ä–µ–∑ –º—è—á",t:"–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–∞ –º—ã—à—Ü—ã –∫–æ—Ä–∞ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º."},{n:"–õ—É–Ω–æ—Ö–æ–¥",t:"–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ–≥–æ —Ç–µ–ª–∞."},{n:"–ë–æ–∫–æ–≤—ã–µ –≤—ã–ø–∞–¥—ã —Å —É–¥–µ—Ä–∂–∞–Ω–∏–µ–º",t:"–°–¥–µ–ª–∞–π—Ç–µ —à–∏—Ä–æ–∫–∏–π —à–∞–≥ –≤–ø—Ä–∞–≤–æ, –ø–µ—Ä–µ–Ω–æ—Å—è –≤–µ—Å —Ç–µ–ª–∞ –Ω–∞ –ø—Ä–∞–≤—É—é –Ω–æ–≥—É –∏ —Å–≥–∏–±–∞—è –µ–µ –≤ –∫–æ–ª–µ–Ω–µ. –ó–∞–¥–µ—Ä–∂–∏—Ç–µ—Å—å –Ω–∞ 2-3 —Å–µ–∫—É–Ω–¥—ã. –ó–∞—Ç–µ–º –æ—Ç—Ç–æ–ª–∫–Ω–∏—Ç–µ—Å—å –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ."},{n:"–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–ª–∞–Ω–∫–∞: –ø–µ—Ä–µ—Ö–æ–¥ –≤ –±–æ–∫–æ–≤—É—é –ø–ª–∞–Ω–∫—É —Å –ø–æ–¥—ä—ë–º–æ–º –±–µ–¥—Ä–∞",t:"–ù–∞—á–Ω–∏—Ç–µ —Å –ø–ª–∞–Ω–∫–∏ –Ω–∞ –ø—Ä—è–º—ã—Ö —Ä—É–∫–∞—Ö. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –∫–æ—Ä–ø—É—Å –≤–ø—Ä–∞–≤–æ, –ø—Ä–∏–Ω–∏–º–∞—è –±–æ–∫–æ–≤—É—é –ø–ª–∞–Ω–∫—É. –û–ø—É—Å—Ç–∏—Ç–µ –±–µ–¥—Ä–∞ –≤–Ω–∏–∑ –∏ —Å–Ω–æ–≤–∞ –ø–æ–¥–Ω–∏–º–∏—Ç–µ –∏—Ö. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –ø–ª–∞–Ω–∫—É –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–ª–µ–≤–æ."}];
let cfg={wT:45,rT:15,crT:60,cdT:5},ct=cfg.wT,run=false,pause=false,ph='work',ei=0,cc=1,tc=5,ti=null,cda=false,vol=1,fs=false,wl=null,mi=null,st=true;const wls='wakeLock'in navigator;
const $=(s)=>document.getElementById(s),$$=(s)=>document.querySelector(s);const te=$('timer'),en=$('exerciseName'),phe=$('phase'),ci=$('circleInfo'),sta=$('status'),sb=$('startBtn'),pb=$('pauseBtn'),rb=$('resetBtn'),cs=$('circles'),el=$('exercisesList'),vs=$('volume'),vv=$('volumeValue'),fb=$('fullscreenBtn'),ka=$('keepAliveInfo'),ne=$('nextExercise'),nen=$('nextExerciseName'),tq=$('technique'),ht=$('hintToggle'),ps=$('programSelect'),lp=$('loadProgramBtn');
function uExDet(){en.textContent=ex[ei].n;tq.textContent=ex[ei].t;let ni=ei+1,ncir=cc;if(ni>=ex.length){ni=0;ncir=cc+1}nen.textContent=ncir<=tc?ex[ni].n:"–ö–æ–Ω–µ—Ü —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏";ph==='rest'||ph==='circleRest'?ne.classList.add('show'):ne.classList.remove('show');uActEx()}
function tTV(){st=!st;ht.textContent=st?"–û–∑–≤—É—á–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É ‚úì":"–û–∑–≤—É—á–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É";localStorage.setItem('st',st)}
function spExT(){let txt=`–ù–∞—á–∏–Ω–∞–µ–º ${ex[ei].n}`;if(st)txt+=`. ${ex[ei].t}`;sp(txt)}
function sMKA(){if(mi)return;mi=setInterval(()=>{const x=Math.floor(Math.random()*3),y=Math.floor(Math.random()*3);window.dispatchEvent(new MouseEvent('mousemove',{view:window,bubbles:true,cancelable:true,clientX:x,clientY:y}))},10000);ka.textContent='üîã –≠–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω (–ú—ã—à—å)';ka.classList.remove('wakelock');ka.classList.add('active')}
function stopMKA(){if(mi){clearInterval(mi);mi=null;ka.classList.remove('active')}}
async function rWL(){const sc=window.isSecureContext||window.location.protocol==='https:'||window.location.hostname==='localhost'||window.location.hostname==='127.0.0.1';if(wls&&sc){try{if(wl!==null)return;wl=await navigator.wakeLock.request('screen');ka.textContent='üîã –≠–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω (Wake Lock)';ka.classList.add('active','wakelock');wl.addEventListener('release',()=>{ka.classList.remove('active');wl=null;if(run&&!pause)sMKA()});return}catch(e){console.error('WL err:',e)}}sMKA()}
async function relKA(){stopMKA();if(wl!==null){try{await wl.release();wl=null}catch(e){console.error('WL rel err:',e)}}ka.classList.remove('active')}
async function stW(){if(run)return;run=true;pause=false;sb.disabled=true;pb.disabled=false;sta.textContent='–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å!';sta.style.color='#68d391';await rWL();spExT();ti=setInterval(uTim,1000)}
async function tPa(){if(!run)return;pause=!pause;if(pause){clearInterval(ti);pb.textContent='‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';sta.textContent='–ü–∞—É–∑–∞';sta.style.color='#ffd166';sp("–ü–∞—É–∑–∞");await relKA()}else{ti=setInterval(uTim,1000);pb.textContent='‚è∏ –ü–∞—É–∑–∞';sta.textContent='–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º';sta.style.color='#68d391';sp("–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º");await rWL()}}
async function res(){clearInterval(ti);ct=cfg.wT;run=false;pause=false;ph='work';ei=0;cc=1;cda=false;sb.disabled=false;pb.disabled=true;pb.textContent='‚è∏ –ü–∞—É–∑–∞';sta.textContent='–ì–æ—Ç–æ–≤ –∫ –Ω–∞—á–∞–ª—É';sta.style.color='#ff9e6d';await relKA();uDis();sp("–°–±—Ä–æ—à–µ–Ω–æ")}
function uTim(){if(pause)return;if(ct<=cfg.cdT&&ct>0){if(!cda)cda=true;spCd(ct)}else cda=false;ct--;if(ct<=0)hTC();uDis()}
function hTC(){cda=false;switch(ph){case 'work':sp("–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ");if(ei===ex.length-1){if(cc===tc){cmpW();return}else{ph='circleRest';ct=cfg.crT;sp("–û—Ç–¥—ã—Ö –º–µ–∂–¥—É –∫—Ä—É–≥–∞–º–∏. –°–ª–µ–¥—É—é—â–∏–π –∫—Ä—É–≥ —Å "+ex[0].n.toLowerCase())}}else{ph='rest';ct=cfg.rT;sp("–û—Ç–¥—ã—Ö. –î–∞–ª–µ–µ: "+ex[ei+1].n.toLowerCase())}break;case 'rest':ei++;ph='work';ct=cfg.wT;spExT();break;case 'circleRest':cc++;ei=0;ph='work';ct=cfg.wT;if(cc<=tc){sp(`–ù–∞—á–∏–Ω–∞–µ–º ${cc} –∫—Ä—É–≥`);spExT()}break}uDis()}
async function cmpW(){clearInterval(ti);run=false;sta.textContent='üéâ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!';sta.style.color='#ffd166';sb.disabled=false;pb.disabled=true;await relKA();document.querySelectorAll('.exercise-item').forEach(i=>i.classList.add('completed'));sp("–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!")}
async function ldCat(){try{const r=await fetch('https://raw.githubusercontent.com/CAMOPKAH/SportTrainDeepTabata/main/workouts/index.json');if(!r.ok)throw new Error('Err');const d=await r.json();ps.innerHTML='<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É</option>';d.programs.forEach(p=>{const o=document.createElement('option');o.value=p.url;o.textContent=p.name;ps.appendChild(o)})}catch(e){console.error('Cat err:',e);sta.textContent='–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º'}}
async function ldProg(u){if(!u)return;try{const r=await fetch(u);if(!r.ok)throw new Error('Err');const d=await r.json();ex=d.exercises.map(e=>({n:e.name,t:e.technique}));cfg=d.config;$$('h1').textContent=`üî• ${d.name}`;$$('.subtitle').textContent=d.description||'–¢–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏';res();uExL();sta.textContent='–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!';sp("–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: "+d.name)}catch(e){console.error('Prog err:',e);sta.textContent='–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'}}
function init(){const ss=localStorage.getItem('st');if(ss!==null)st=ss==='true';ht.textContent=st?"–û–∑–≤—É—á–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É ‚úì":"–û–∑–≤—É—á–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É";tc=parseInt(cs.value);uExL();uDis();sb.addEventListener('click',stW);pb.addEventListener('click',tPa);rb.addEventListener('click',res);ht.addEventListener('click',tTV);cs.addEventListener('change',()=>{tc=parseInt(cs.value);uCiI()});vs.addEventListener('input',e=>{vol=parseFloat(e.target.value);vv.textContent=`${Math.round(vol*100)}%`});fb.addEventListener('click',tFs);['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange'].forEach(ev=>document.addEventListener(ev,uFsB));if(!('speechSynthesis'in window)){sta.textContent='–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å';sta.style.color='#ff6b6b'}ldCat();lp.addEventListener('click',()=>ldProg(ps.value))}
function uExL(){el.innerHTML='';ex.forEach((e,i)=>{const d=document.createElement('div');d.className='exercise-item';d.id=`ex-${i}`;d.innerHTML=`<span>${i+1}. ${e.n}</span><span>45 —Å–µ–∫</span>`;d.addEventListener('click',()=>{if(!run){ei=i;uDis()}});el.appendChild(d)})}
function uActEx(){document.querySelectorAll('.exercise-item').forEach(i=>i.classList.remove('active','completed'));for(let i=0;i<ei;i++){const it=$(`ex-${i}`);if(it)it.classList.add('completed')}const cur=$(`ex-${ei}`);if(cur)cur.classList.add('active')}
function uDis(){te.textContent=ct;phe.textContent=ph==='work'?'–†–∞–±–æ—Ç–∞':ph==='rest'?'–û—Ç–¥—ã—Ö':'–û—Ç–¥—ã—Ö –º–µ–∂–¥—É –∫—Ä—É–≥–∞–º–∏';uCiI();uExDet()}
function uCiI(){ci.textContent=`–ö—Ä—É–≥: ${cc}/${tc}`}
function sp(txt){if(!('speechSynthesis'in window))return;speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(txt);u.lang='ru-RU';u.rate=1;u.pitch=1;u.volume=vol;const vs=speechSynthesis.getVoices();const rv=vs.find(v=>v.lang.includes('ru')||v.lang.includes('RU'));if(rv)u.voice=rv;speechSynthesis.speak(u)}
function spCd(s){if(s>0&&s<=5)sp(s.toString())}
function tFs(){fs?exFs():enFs()}
function enFs(){const e=document.documentElement;if(e.requestFullscreen)e.requestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.msRequestFullscreen)e.msRequestFullscreen()}
function exFs(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.msExitFullscreen)document.msExitFullscreen()}
function uFsB(){const fe=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;fs=!!fe;if(fs){fb.innerHTML='‚õ∂';fb.title='–í—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞';document.body.classList.add('fullscreen')}else{fb.innerHTML='‚õ∂';fb.title='–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º';document.body.classList.remove('fullscreen')}}
document.addEventListener('keydown',e=>{if(e.key==='Escape'&&fs)setTimeout(uFsB,100);if(e.code==='Space'){e.preventDefault();run?tPa():stW()}if(e.code==='KeyR'&&e.ctrlKey){e.preventDefault();res()}if(e.code==='KeyF'){e.preventDefault();tFs()}if(e.code==='KeyH'&&e.ctrlKey){e.preventDefault();tTV()}});
document.addEventListener('visibilitychange',async()=>{if(document.visibilityState==='visible'&&run&&!pause){try{await rWL()}catch(e){console.error('WL err:',e)}}});
window.addEventListener('DOMContentLoaded',init);speechSynthesis.getVoices();if(speechSynthesis.onvoiceschanged!==undefined)speechSynthesis.onvoiceschanged=()=>{};
window.addEventListener('beforeunload',()=>{if(wl!==null)wl.release();if(mi)clearInterval(mi)});
</script>
</body>
</html>
