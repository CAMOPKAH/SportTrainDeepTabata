# Руководство по работе с каталогом программ

## Обзор

Система позволяет удобно выбирать программы тренировок из каталога и загружать дополнительные CSS/JS файлы для кастомизации. Поддерживаются две версии формата каталога:
- **Версия 1.0** - плоский список программ (обратная совместимость)
- **Версия 2.0** - древовидная структура с папками и дополнительными полями

## Структура каталога

### Версия 1.0 (старый формат)
Каталог программ хранится в формате JSON:

```json
{
  "programs": [
    {
      "name": "Название программы",
      "description": "Описание программы",
      "url": "workouts/program1.json",
      "category": "Кардио",
      "difficulty": "medium",
      "duration": "30 минут",
      "exercisesCount": 10,
      "css": ["styles/custom.css"],
      "js": ["scripts/custom.js"]
    }
  ]
}
```

### Поля программы (версия 1.0):

- **name** (обязательно) - Название программы
- **description** - Описание программы
- **url** (обязательно) - Путь к JSON файлу программы (относительно корня репозитория)
- **category** - Категория (например: Кардио, Сила, Функциональная)
- **difficulty** - Сложность: `easy`, `medium`, `hard`, `expert`
- **duration** - Длительность тренировки
- **exercisesCount** - Количество упражнений
- **css** - Массив путей к CSS файлам или один путь (строкой)
- **js** - Массив путей к JS файлам или один путь (строкой)

### Версия 2.0 (новый формат с древовидной структурой)

```json
{
  "version": "2.0",
  "metadata": {
    "name": "Каталог тренировок",
    "description": "Древовидная структура тренировок",
    "created": "2025-01-25"
  },
  "folders": [
    {
      "id": "folder1",
      "name": "Кардио тренировки",
      "icon": "fa-heartbeat",
      "description": "Тренировки для развития выносливости",
      "folders": [
        {
          "id": "subfolder1",
          "name": "Интервальные",
          "icon": "fa-bolt",
          "programs": [
            {
              "id": "program1",
              "name": "Интервальный бег",
              "description": "Интервальная тренировка для бегунов",
              "url": "workouts/interval-running.json",
              "difficulty": "medium",
              "level": "intermediate",
              "duration": 30,
              "durationDisplay": "30 минут",
              "exercisesCount": 8,
              "equipment": "беговая дорожка, кроссовки",
              "calories": 300,
              "focusAreas": ["ноги", "сердечно-сосудистая система"],
              "css": ["styles/cardio.css"],
              "js": ["scripts/stats.js"]
            }
          ]
        }
      ]
    }
  ],
  "programs": [] // Для обратной совместимости
}
```

#### Поля каталога (версия 2.0):

- **version** (обязательно) - Версия формата ("2.0")
- **metadata** - Метаданные каталога
- **folders** - Массив папок с древовидной структурой
- **programs** - Плоский список программ для обратной совместимости

#### Поля папки:

- **id** (обязательно) - Уникальный идентификатор папки
- **name** (обязательно) - Название папки
- **icon** - Иконка Font Awesome (например: "fa-heartbeat", "fa-dumbbell")
- **description** - Описание папки
- **folders** - Вложенные папки (рекурсивно)
- **programs** - Программы в этой папке

#### Новые поля программы (версия 2.0):

- **id** - Уникальный идентификатор программы
- **level** - Уровень сложности: `beginner`, `intermediate`, `advanced`, `expert`
- **duration** - Длительность в минутах (число)
- **durationDisplay** - Отображаемая длительность (строка)
- **equipment** - Инвентарь через запятую
- **calories** - Примерное количество калорий
- **focusAreas** - Целевые группы мышц (массив строк)
- **folderId** - ID родительской папки (автоматически)
- **folderName** - Название родительской папки (автоматически)
- **folderIcon** - Иконка родительской папки (автоматически)

**Примечание:** Поле `difficulty` сохраняется для обратной совместимости, но рекомендуется использовать `level`.

## Использование редактора каталога

1. Откройте `catalog-editor.html` в браузере
2. Заполните форму для добавления новой программы
3. Нажмите "Добавить программу"
4. Используйте кнопки:
   - **Экспортировать каталог** - сохранить JSON файл
   - **Импортировать каталог** - загрузить существующий JSON
   - **Загрузить с GitHub** - загрузить каталог с GitHub репозитория

## Формат файла программы (JSON)

### Базовый формат:
```json
{
  "name": "Название программы",
  "description": "Описание",
  "exercises": [
    {
      "name": "Название упражнения",
      "technique": "Техника выполнения"
    }
  ],
  "config": {
    "workTime": 45,
    "restTime": 15,
    "circleRestTime": 60,
    "countdownTime": 5
  }
}
```

### Расширенный формат с дополнительными полями (опционально):
```json
{
  "name": "Название программы",
  "description": "Описание",
  "exercises": [
    {
      "name": "Название упражнения",
      "technique": "Техника выполнения",
      "difficulty": "medium",
      "duration": 45,
      "equipment": "гантели, коврик",
      "muscleGroups": ["грудь", "трицепсы"]
    }
  ],
  "config": {
    "workTime": 45,
    "restTime": 15,
    "circleRestTime": 60,
    "countdownTime": 5
  },
  "metadata": {
    "level": "intermediate",
    "equipment": "гантели, скамья, турник",
    "calories": 280,
    "focusAreas": ["верх тела", "сила"]
  }
}
```

#### Дополнительные поля упражнения (опционально):
- **difficulty** - Сложность упражнения
- **duration** - Длительность выполнения (секунды)
- **equipment** - Необходимый инвентарь
- **muscleGroups** - Целевые группы мышц (массив строк)

#### Дополнительные поля программы (опционально):
- **metadata** - Метаданные программы
  - **level** - Уровень сложности программы
  - **equipment** - Общий инвентарь для программы
  - **calories** - Примерное количество калорий
  - **focusAreas** - Целевые области тренировки

## Загрузка CSS/JS файлов

При выборе программы система автоматически:

1. Загружает CSS файлы и добавляет их в `<head>`
2. Загружает JS файлы и добавляет их в `<body>`
3. При смене программы удаляет предыдущие динамические ресурсы

### Пути к файлам

Все пути указываются относительно корня репозитория:
- `https://raw.githubusercontent.com/CAMOPKAH/SportTrainDeepTabata/main/`

Например:
- CSS: `styles/custom.css` → `https://raw.githubusercontent.com/CAMOPKAH/SportTrainDeepTabata/main/styles/custom.css`
- JS: `scripts/custom.js` → `https://raw.githubusercontent.com/CAMOPKAH/SportTrainDeepTabata/main/scripts/custom.js`
- Программа: `workouts/program1.json` → `https://raw.githubusercontent.com/CAMOPKAH/SportTrainDeepTabata/main/workouts/program1.json`

## Использование в приложении

1. Нажмите кнопку "Выбрать программу"
2. В модальном окне найдите нужную программу (можно использовать поиск)
3. Нажмите "Выбрать" на карточке программы
4. Программа загрузится вместе с CSS/JS файлами (если указаны)

## Размещение файлов на GitHub

Рекомендуемая структура репозитория:

```
SportTrainDeepTabata/
├── workouts/
│   ├── index.json          # Каталог программ
│   ├── program1.json       # Программа 1
│   └── program2.json       # Программа 2
├── styles/
│   └── custom.css          # Кастомные стили
└── scripts/
    └── custom.js           # Кастомные скрипты
```

## Примеры использования

### Программа с кастомными стилями

```json
{
  "name": "Темная тема",
  "description": "Программа с темной темой оформления",
  "url": "workouts/dark-theme.json",
  "css": "styles/dark-theme.css"
}
```

### Программа с несколькими ресурсами

```json
{
  "name": "Расширенная программа",
  "description": "С дополнительными функциями",
  "url": "workouts/advanced.json",
  "css": ["styles/advanced.css", "styles/animations.css"],
  "js": ["scripts/advanced.js", "scripts/stats.js"]
}
```

## Миграция с версии 1.0 на 2.0

### Автоматическая миграция
Система автоматически определяет версию каталога и обрабатывает данные соответствующим образом. Старые каталоги (версия 1.0) продолжают работать без изменений.

### Ручная миграция
Чтобы вручную преобразовать каталог из версии 1.0 в 2.0:

1. Добавьте поле `"version": "2.0"` в корень каталога
2. Добавьте поле `metadata` с информацией о каталоге
3. Создайте структуру папок в поле `folders`
4. Перенесите программы в соответствующие папки
5. Добавьте новые поля к программам (id, level, equipment и т.д.)
6. Сохраните старый список программ в поле `programs` для обратной совместимости

### Пример миграции
**До (версия 1.0):**
```json
{
  "programs": [
    {
      "name": "Интервальный бег",
      "description": "Интервальная тренировка",
      "url": "workouts/running.json",
      "category": "Кардио",
      "difficulty": "medium",
      "duration": "30 минут"
    }
  ]
}
```

**После (версия 2.0):**
```json
{
  "version": "2.0",
  "metadata": {
    "name": "Мой каталог",
    "created": "2025-01-25"
  },
  "folders": [
    {
      "id": "cardio",
      "name": "Кардио",
      "icon": "fa-heartbeat",
      "programs": [
        {
          "id": "interval-running",
          "name": "Интервальный бег",
          "description": "Интервальная тренировка",
          "url": "workouts/running.json",
          "difficulty": "medium",
          "level": "intermediate",
          "duration": 30,
          "durationDisplay": "30 минут",
          "equipment": "беговая дорожка, кроссовки"
        }
      ]
    }
  ],
  "programs": [
    {
      "name": "Интервальный бег",
      "description": "Интервальная тренировка",
      "url": "workouts/running.json",
      "category": "Кардио",
      "difficulty": "medium",
      "duration": "30 минут"
    }
  ]
}
```

## Обратная совместимость

### Поддерживаемые функции:
1. **Автоматическое определение версии** - система определяет версию по полю `version`
2. **Обработка старых каталогов** - каталоги без поля `version` обрабатываются как версия 1.0
3. **Плоский список программ** - в версии 2.0 сохраняется поле `programs` для совместимости
4. **Совместимость полей** - старые поля (`difficulty`, `duration` как строка) продолжают работать
5. **Поиск и фильтрация** - работают с обеими версиями каталогов

### Новые возможности версии 2.0:
1. **Древовидная структура** - организация программ в папки и подпапки
2. **Иконки папок** - визуальное оформление с Font Awesome иконками
3. **Дополнительные поля** - уровень сложности, инвентарь, калории и т.д.
4. **Улучшенный UI** - хлебные крошки, карточки папок, сетка информации
5. **Расширенный поиск** - поиск по инвентарю, папкам и новым полям

## Примечания

- CSS и JS файлы загружаются асинхронно
- При ошибке загрузки CSS/JS файла программа все равно загрузится (с предупреждением в консоли)
- Динамические ресурсы автоматически удаляются при смене программы
- Каталог кэшируется после первой загрузки
- Система автоматически обрабатывает обе версии каталогов
- Для новых проектов рекомендуется использовать версию 2.0
- Существующие каталоги можно постепенно мигрировать на новую версию
