<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–π–º–µ—Ä –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white; min-height: 100vh; padding: 20px; transition: all 0.3s ease;
        }
        body.fullscreen { padding: 0; }
        .container {
            max-width: 800px; margin: 0 auto; background: rgba(0, 0, 0, 0.7);
            border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        body.fullscreen .container {
            max-width: 100%; height: 100vh; border-radius: 0; padding: 20px;
            display: flex; flex-direction: column;
        }
        .header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
        }
        h1 {
            text-align: center; margin-bottom: 10px; color: #ff6b6b;
            font-size: 2.5rem; flex-grow: 1;
        }
        body.fullscreen h1 { font-size: 2.2rem; }
        .subtitle {
            text-align: center; color: #4ecdc4; margin-bottom: 30px; font-size: 1.2rem;
        }
        .fullscreen-btn {
            background: #4ecdc4; color: white; border: none; border-radius: 10px;
            width: 40px; height: 40px; display: flex; align-items: center;
            justify-content: center; cursor: pointer; font-size: 1.2rem;
            transition: all 0.3s ease; margin-left: 10px;
        }
        .fullscreen-btn:hover { background: #3dbcb3; transform: scale(1.1); }
        .control-panel {
            background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px;
            margin-bottom: 30px; display: flex; flex-wrap: wrap; gap: 15px;
            justify-content: center; align-items: center;
        }
        .control-group { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        label { font-size: 0.9rem; color: #ffd166; }
        select, button {
            padding: 12px 20px; border: none; border-radius: 10px;
            font-size: 1rem; cursor: pointer; transition: all 0.3s ease;
        }
        select { background: #2c3e50; color: white; min-width: 150px; }
        .action-btn {
            background: #ff6b6b; color: white; font-weight: bold;
            text-transform: uppercase; letter-spacing: 1px; min-width: 120px;
        }
        .action-btn:hover {
            background: #ff5252; transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .action-btn:disabled {
            background: #6c757d; cursor: not-allowed; transform: none; box-shadow: none;
        }
        .timer-display {
            text-align: center; margin-bottom: 30px; padding: 30px;
            background: rgba(0, 0, 0, 0.5); border-radius: 15px; border: 3px solid #4ecdc4;
            flex-grow: 1; display: flex; flex-direction: column; justify-content: center;
        }
        body.fullscreen .timer-display { padding: 20px; margin-bottom: 20px; }
        .time {
            font-size: 5rem; font-weight: bold; margin-bottom: 10px; color: #4ecdc4;
            text-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }
        body.fullscreen .time { font-size: 6rem; }
        .exercise-info {
            font-size: 1.8rem; color: #ffd166; margin-bottom: 10px; min-height: 60px;
        }
        body.fullscreen .exercise-info { font-size: 2.2rem; }
        .phase-info { font-size: 1.2rem; color: #ff9e6d; margin-bottom: 5px; }
        body.fullscreen .phase-info { font-size: 1.5rem; }
        .circle-info { font-size: 1.1rem; color: #a3b5cc; }
        body.fullscreen .circle-info { font-size: 1.3rem; }
        .status {
            font-size: 1.5rem; color: #ff9e6d; text-align: center; margin-top: 20px;
            min-height: 30px;
        }
        body.fullscreen .status { font-size: 1.8rem; }
        .workout-list {
            background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px;
            margin-top: 30px;
        }
        body.fullscreen .workout-list { margin-top: 0; }
        .workout-list h3 { color: #4ecdc4; margin-bottom: 15px; text-align: center; }
        .exercise-item {
            padding: 10px 15px; margin: 5px 0; background: rgba(255, 255, 255, 0.1);
            border-radius: 8px; display: flex; justify-content: space-between;
            transition: all 0.3s ease;
        }
        .exercise-item.active {
            background: rgba(78, 205, 196, 0.3); border-left: 4px solid #4ecdc4;
            transform: translateX(5px);
        }
        .exercise-item.completed { opacity: 0.7; color: #a3b5cc; }
        .volume-control { display: flex; align-items: center; gap: 10px; margin-top: 15px; }
        .volume-control input { flex-grow: 1; }
        .keep-alive-info {
            position: fixed; bottom: 20px; right: 20px; background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px; border-radius: 10px; font-size: 0.9rem; color: #ffd166;
            display: none; z-index: 1000; border: 1px solid #ffd166;
        }
        .keep-alive-info.active { display: block; }
        .keep-alive-info.wakelock { color: #4ecdc4; border-color: #4ecdc4; }
        @media (max-width: 600px) {
            .container { padding: 15px; }
            .time { font-size: 3.5rem; }
            body.fullscreen .time { font-size: 4.5rem; }
            .exercise-info { font-size: 1.4rem; }
            body.fullscreen .exercise-info { font-size: 1.8rem; }
            .control-panel { flex-direction: column; }
        }
        @media (max-height: 800px) and (orientation: landscape) {
            body.fullscreen .container { padding: 10px; }
            body.fullscreen .timer-display { padding: 10px; }
            body.fullscreen .time { font-size: 4rem; }
            body.fullscreen .exercise-info { font-size: 1.6rem; min-height: 40px; }
            .workout-list { display: none; }
        }
    </style>
</head>
<body>
    <div class="keep-alive-info" id="keepAliveInfo">üîã –≠–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω</div>
    <div class="container">
        <div class="header">
            <h1>üî• –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ñ–∏—Ä–æ—Å–∂–∏–≥–∞—Ç–µ–ª—å</h1>
            <button class="fullscreen-btn" id="fullscreenBtn" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º">‚õ∂</button>
        </div>
        <div class="subtitle">–¢–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è–º–∏</div>
        <div class="control-panel">
            <div class="control-group">
                <label for="circles">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É–≥–æ–≤:</label>
                <select id="circles">
                    <option value="3">3 –∫—Ä—É–≥–∞</option><option value="4">4 –∫—Ä—É–≥–∞</option>
                    <option value="5" selected>5 –∫—Ä—É–≥–æ–≤</option><option value="6">6 –∫—Ä—É–≥–æ–≤</option>
                    <option value="7">7 –∫—Ä—É–≥–æ–≤</option><option value="8">8 –∫—Ä—É–≥–æ–≤</option>
                    <option value="9">9 –∫—Ä—É–≥–æ–≤</option>
                </select>
            </div>
            <button class="action-btn" id="startBtn">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
            <button class="action-btn" id="pauseBtn" disabled>‚è∏ –ü–∞—É–∑–∞</button>
            <button class="action-btn" id="resetBtn">üîÑ –°–±—Ä–æ—Å</button>
            <div class="volume-control">
                <span>üîä</span><input type="range" id="volume" min="0" max="1" step="0.1" value="1">
                <span id="volumeValue">100%</span>
            </div>
        </div>
        <div class="timer-display">
            <div class="time" id="timer">45</div>
            <div class="exercise-info" id="exerciseName">–î–∂–∞–º–ø –¥–∂–µ–∫</div>
            <div class="phase-info" id="phase">–†–∞–±–æ—Ç–∞</div>
            <div class="circle-info" id="circleInfo">–ö—Ä—É–≥: 1/5</div>
        </div>
        <div class="status" id="status">–ì–æ—Ç–æ–≤ –∫ –Ω–∞—á–∞–ª—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
        <div class="workout-list">
            <h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ –∫—Ä—É–≥–µ:</h3>
            <div id="exercisesList"></div>
        </div>
    </div>

    <script>
        // ================= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –¢–†–ï–ù–ò–†–û–í–ö–ò =================
        const workoutConfig = {
            workTime: 45, restTime: 15, circleRestTime: 60, countdownTime: 5
        };
        const exercises = [
            "–î–∂–∞–º–ø –¥–∂–µ–∫", "–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è (–∏–ª–∏ –ê–≤—Å—Ç—Ä–∞–ª–∏–π—Å–∫–∏–µ)", "–ë—ë—Ä–ø–∏", "–û—Ç–∂–∏–º–∞–Ω–∏—è",
            "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –≤—ã–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ–º", "–í–µ–ª–æ—Å–∏–ø–µ–¥", "–ê–ª—å–ø–∏–Ω–∏—Å—Ç Cross-body",
            "–í—ã–ø–∞–¥—ã —Å –º–µ—Å—Ç–∞", "–†—É–∫–æ—Ö–æ–¥ –≤ –ø–ª–∞–Ω–∫–µ"
        ];

        // ================= –ü–ï–†–ï–ú–ï–ù–ù–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø =================
        let currentTime = workoutConfig.workTime;
        let isRunning = false, isPaused = false;
        let currentPhase = 'work';
        let currentExerciseIndex = 0, currentCircle = 1, totalCircles = 5;
        let timerInterval = null, countdownActive = false, speechVolume = 1;
        let isFullscreen = false, wakeLock = null, mouseKeepAliveInterval = null;
        const wakeLockSupported = 'wakeLock' in navigator;

        // ================= –≠–õ–ï–ú–ï–ù–¢–´ DOM =================
        const timerElement = document.getElementById('timer');
        const exerciseNameElement = document.getElementById('exerciseName');
        const phaseElement = document.getElementById('phase');
        const circleInfoElement = document.getElementById('circleInfo');
        const statusElement = document.getElementById('status');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const circlesSelect = document.getElementById('circles');
        const exercisesListElement = document.getElementById('exercisesList');
        const volumeSlider = document.getElementById('volume');
        const volumeValue = document.getElementById('volumeValue');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const keepAliveInfo = document.getElementById('keepAliveInfo');

        // ================= –ú–ï–•–ê–ù–ò–ó–ú–´ –ü–û–î–î–ï–†–ñ–ê–ù–ò–Ø –ê–ö–¢–ò–í–ù–û–°–¢–ò =================
        // === 1. –ú–ï–¢–û–î "–ü–ï–†–ò–û–î–ò–ß–ï–°–ö–û–ô –ü–û–î–í–ò–ñ–ù–û–°–¢–ò" (–ù–ï–ù–ê–î–ï–ñ–ù–´–ô –ë–ï–ó HTTPS) ===
        function startMouseMoveKeepAlive() {
            console.log('[DEBUG] –ó–∞–ø—É—Å–∫ –º–µ—Ç–æ–¥–∞ "–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏"');
            if (mouseKeepAliveInterval) {
                console.log('[DEBUG] –ú–µ—Ç–æ–¥ —É–∂–µ –∑–∞–ø—É—â–µ–Ω');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –º–∏–∫—Ä–æ-—Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –º—ã—à–∏ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            mouseKeepAliveInterval = setInterval(() => {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –Ω–µ–±–æ–ª—å—à–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
                const x = Math.floor(Math.random() * 3); // 0, 1 –∏–ª–∏ 2
                const y = Math.floor(Math.random() * 3);
                
                console.log(`[DEBUG] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è mousemove (x: ${x}, y: ${y})`);
                
                // –°–æ–∑–¥–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –º—ã—à–∏
                const mouseEvent = new MouseEvent('mousemove', {
                    view: window,
                    bubbles: true,
                    cancelable: true,
                    clientX: x,
                    clientY: y
                });
                
                window.dispatchEvent(mouseEvent);
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –±–æ–ª—å—à–µ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                const touchEvent = new TouchEvent('touchmove', {
                    bubbles: true,
                    cancelable: true,
                    touches: [new Touch({
                        identifier: Date.now(),
                        target: document.body,
                        clientX: x,
                        clientY: y
                    })]
                });
                document.body.dispatchEvent(touchEvent);
                
            }, 10000); // –ò–Ω—Ç–µ—Ä–≤–∞–ª 10 —Å–µ–∫—É–Ω–¥
            
            keepAliveInfo.textContent = 'üîã –≠–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω (–ú—ã—à—å)';
            keepAliveInfo.classList.remove('wakelock');
            keepAliveInfo.classList.add('active');
        }

        function stopMouseMoveKeepAlive() {
            console.log('[DEBUG] –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ—Ç–æ–¥–∞ "–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏"');
            if (mouseKeepAliveInterval) {
                clearInterval(mouseKeepAliveInterval);
                mouseKeepAliveInterval = null;
                keepAliveInfo.classList.remove('active');
            }
        }

        // === 2. WAKE LOCK API (–†–ê–ë–û–¢–ê–ï–¢ –¢–û–õ–¨–ö–û –ù–ê LOCALHOST/HTTPS) ===
        async function requestWakeLock() {
            console.log('[DEBUG] –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Wake Lock...');
            console.log('[DEBUG] Wake Lock –¥–æ—Å—Ç—É–ø–µ–Ω?', wakeLockSupported);
            console.log('[DEBUG] –ü—Ä–æ—Ç–æ–∫–æ–ª:', window.location.protocol);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (https: –∏–ª–∏ localhost)
            const isSecureContext = window.isSecureContext || 
                                   window.location.protocol === 'https:' || 
                                   window.location.hostname === 'localhost' ||
                                   window.location.hostname === '127.0.0.1';
            
            console.log('[DEBUG] –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç?', isSecureContext);
            
            // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Wake Lock API –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –º—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
            if (wakeLockSupported && isSecureContext) {
                try {
                    if (wakeLock !== null) {
                        console.log('[DEBUG] Wake Lock —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω');
                        return;
                    }
                    
                    console.log('[DEBUG] –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º Wake Lock...');
                    wakeLock = await navigator.wakeLock.request('screen');
                    
                    console.log('[DEBUG] Wake Lock —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
                    keepAliveInfo.textContent = 'üîã –≠–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–µ–Ω (Wake Lock)';
                    keepAliveInfo.classList.add('active', 'wakelock');
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è
                    wakeLock.addEventListener('release', () => {
                        console.log('[DEBUG] Wake Lock –±—ã–ª –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω —Å–∏—Å—Ç–µ–º–æ–π');
                        keepAliveInfo.classList.remove('active');
                        wakeLock = null;
                        
                        // –ï—Å–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –µ—â–µ –∏–¥–µ—Ç, –ø—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –º–µ—Ç–æ–¥ –º—ã—à–∏
                        if (isRunning && !isPaused) {
                            console.log('[DEBUG] –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –º–µ—Ç–æ–¥ –º—ã—à–∏ –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è Wake Lock');
                            startMouseMoveKeepAlive();
                        }
                    });
                    
                    return; // –£—Å–ø–µ—à–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ Wake Lock
                    
                } catch (err) {
                    console.error('[DEBUG] –û—à–∏–±–∫–∞ Wake Lock:', err.name, err.message);
                    keepAliveInfo.textContent = '‚ö† Wake Lock –æ—à–∏–±–∫–∞';
                    keepAliveInfo.style.color = '#ff6b6b';
                    setTimeout(() => {
                        keepAliveInfo.style.color = '';
                    }, 3000);
                }
            }
            
            // –ï—Å–ª–∏ Wake Lock –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ –º—ã—à–∏
            console.log('[DEBUG] –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ "–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏"');
            startMouseMoveKeepAlive();
        }

        async function releaseKeepAlive() {
            console.log('[DEBUG] –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ keep-alive');
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ—Ç–æ–¥ –º—ã—à–∏
            stopMouseMoveKeepAlive();
            
            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º Wake Lock –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
            if (wakeLock !== null) {
                try {
                    await wakeLock.release();
                    wakeLock = null;
                    console.log('[DEBUG] Wake Lock –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω');
                } catch (err) {
                    console.error('[DEBUG] –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–∏ Wake Lock:', err);
                }
            }
            
            keepAliveInfo.classList.remove('active');
        }

        // ================= –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –¢–†–ï–ù–ò–†–û–í–ö–ò =================
        async function startWorkout() {
            if (isRunning) return;
            
            console.log('[DEBUG] === –ù–ê–ß–ê–õ–û –¢–†–ï–ù–ò–†–û–í–ö–ò ===');
            console.log('[DEBUG] –ü—Ä–æ—Ç–æ–∫–æ–ª:', window.location.protocol);
            console.log('[DEBUG] Wake Lock –¥–æ—Å—Ç—É–ø–µ–Ω?', wakeLockSupported);
            console.log('[DEBUG] –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç?', window.isSecureContext);
            
            isRunning = true;
            isPaused = false;
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            statusElement.textContent = '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å!';
            statusElement.style.color = '#4ecdc4';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞
            await requestWakeLock();
            
            speak("–ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É! –ü–µ—Ä–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: " + exercises[currentExerciseIndex]);
            timerInterval = setInterval(updateTimer, 1000);
        }

        async function togglePause() {
            if (!isRunning) return;
            
            isPaused = !isPaused;
            
            if (isPaused) {
                clearInterval(timerInterval);
                pauseBtn.textContent = '‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                statusElement.textContent = '–ü–∞—É–∑–∞';
                statusElement.style.color = '#ffd166';
                speak("–ü–∞—É–∑–∞");
                
                // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                await releaseKeepAlive();
            } else {
                timerInterval = setInterval(updateTimer, 1000);
                pauseBtn.textContent = '‚è∏ –ü–∞—É–∑–∞';
                statusElement.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É';
                statusElement.style.color = '#4ecdc4';
                speak("–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º");
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–Ω–æ–≤–∞
                await requestWakeLock();
            }
        }

        async function resetWorkout() {
            console.log('[DEBUG] === –°–ë–†–û–° –¢–†–ï–ù–ò–†–û–í–ö–ò ===');
            clearInterval(timerInterval);
            
            currentTime = workoutConfig.workTime;
            isRunning = false;
            isPaused = false;
            currentPhase = 'work';
            currentExerciseIndex = 0;
            currentCircle = 1;
            countdownActive = false;
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.textContent = '‚è∏ –ü–∞—É–∑–∞';
            
            statusElement.textContent = '–ì–æ—Ç–æ–≤ –∫ –Ω–∞—á–∞–ª—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏';
            statusElement.style.color = '#ff9e6d';
            
            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            await releaseKeepAlive();
            
            updateDisplay();
            speak("–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞");
        }

        function updateTimer() {
            if (isPaused) return;
            
            if (currentTime <= workoutConfig.countdownTime && currentTime > 0) {
                if (!countdownActive) countdownActive = true;
                speakCountdown(currentTime);
            } else {
                countdownActive = false;
            }
            
            currentTime--;
            
            if (currentTime <= 0) {
                handleTimerComplete();
            }
            
            updateDisplay();
        }

        function handleTimerComplete() {
            countdownActive = false;
            
            switch(currentPhase) {
                case 'work':
                    speak("–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ");
                    
                    if (currentExerciseIndex === exercises.length - 1) {
                        if (currentCircle === totalCircles) {
                            completeWorkout();
                            return;
                        } else {
                            currentPhase = 'circleRest';
                            currentTime = workoutConfig.circleRestTime;
                        }
                    } else {
                        currentPhase = 'rest';
                        currentTime = workoutConfig.restTime;
                    }
                    break;
                    
                case 'rest':
                    currentExerciseIndex++;
                    currentPhase = 'work';
                    currentTime = workoutConfig.workTime;
                    speakExerciseStart();
                    break;
                    
                case 'circleRest':
                    currentCircle++;
                    currentExerciseIndex = 0;
                    currentPhase = 'work';
                    currentTime = workoutConfig.workTime;
                    
                    if (currentCircle <= totalCircles) {
                        speak(`–ù–∞—á–∏–Ω–∞–µ–º ${currentCircle} –∫—Ä—É–≥`);
                        speakExerciseStart();
                    }
                    break;
            }
            
            updateDisplay();
        }

        async function completeWorkout() {
            console.log('[DEBUG] === –ó–ê–í–ï–†–®–ï–ù–ò–ï –¢–†–ï–ù–ò–†–û–í–ö–ò ===');
            clearInterval(timerInterval);
            isRunning = false;
            
            statusElement.textContent = 'üéâ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!';
            statusElement.style.color = '#ffd166';
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            await releaseKeepAlive();
            
            document.querySelectorAll('.exercise-item').forEach(item => {
                item.classList.add('completed');
            });
            
            speak("–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –í—ã –ø—Ä–æ–¥–µ–ª–∞–ª–∏ –æ–≥—Ä–æ–º–Ω—ã–π —Ç—Ä—É–¥!");
        }

        // ================= –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =================
        function init() {
            console.log('[DEBUG] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            console.log('[DEBUG] –ü—Ä–æ—Ç–æ–∫–æ–ª:', window.location.protocol);
            console.log('[DEBUG] –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç?', window.isSecureContext);
            console.log('[DEBUG] Wake Lock –¥–æ—Å—Ç—É–ø–µ–Ω?', wakeLockSupported);
            
            // –ï—Å–ª–∏ –º—ã –Ω–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            if (!window.isSecureContext && window.location.protocol !== 'file:') {
                statusElement.innerHTML = '‚ö† –î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ <code>localhost</code> (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é)';
                statusElement.style.color = '#ff6b6b';
            }
            
            totalCircles = parseInt(circlesSelect.value);
            updateExerciseList();
            updateDisplay();
            
            startBtn.addEventListener('click', startWorkout);
            pauseBtn.addEventListener('click', togglePause);
            resetBtn.addEventListener('click', resetWorkout);
            
            circlesSelect.addEventListener('change', () => {
                totalCircles = parseInt(circlesSelect.value);
                updateCircleInfo();
            });
            
            volumeSlider.addEventListener('input', (e) => {
                speechVolume = parseFloat(e.target.value);
                volumeValue.textContent = `${Math.round(speechVolume * 100)}%`;
            });
            
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            const fullscreenEvents = ['fullscreenchange', 'webkitfullscreenchange', 
                                     'mozfullscreenchange', 'MSFullscreenChange'];
            fullscreenEvents.forEach(event => {
                document.addEventListener(event, updateFullscreenButton);
            });
            
            if (!('speechSynthesis' in window)) {
                statusElement.textContent = '–í–Ω–∏–º–∞–Ω–∏–µ: –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤—ã–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è';
                statusElement.style.color = '#ff6b6b';
            }
        }

        function updateExerciseList() {
            exercisesListElement.innerHTML = '';
            exercises.forEach((exercise, index) => {
                const div = document.createElement('div');
                div.className = 'exercise-item';
                div.id = `exercise-${index}`;
                div.innerHTML = `<span>${index + 1}. ${exercise}</span><span>45 —Å–µ–∫</span>`;
                exercisesListElement.appendChild(div);
            });
        }

        function updateActiveExercise() {
            document.querySelectorAll('.exercise-item').forEach(item => {
                item.classList.remove('active', 'completed');
            });
            
            for (let i = 0; i < currentExerciseIndex; i++) {
                const item = document.getElementById(`exercise-${i}`);
                if (item) item.classList.add('completed');
            }
            
            const currentItem = document.getElementById(`exercise-${currentExerciseIndex}`);
            if (currentItem) currentItem.classList.add('active');
        }

        function updateDisplay() {
            timerElement.textContent = currentTime;
            exerciseNameElement.textContent = exercises[currentExerciseIndex];
            phaseElement.textContent = getPhaseText(currentPhase);
            updateCircleInfo();
            updateActiveExercise();
        }

        function getPhaseText(phase) {
            switch(phase) {
                case 'work': return '–†–∞–±–æ—Ç–∞';
                case 'rest': return '–û—Ç–¥—ã—Ö';
                case 'circleRest': return '–û—Ç–¥—ã—Ö –º–µ–∂–¥—É –∫—Ä—É–≥–∞–º–∏';
                default: return '';
            }
        }

        function updateCircleInfo() {
            circleInfoElement.textContent = `–ö—Ä—É–≥: ${currentCircle}/${totalCircles}`;
        }

        function speak(text) {
            if (!('speechSynthesis' in window)) return;
            speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ru-RU';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = speechVolume;
            
            const voices = speechSynthesis.getVoices();
            const russianVoice = voices.find(voice => 
                voice.lang.includes('ru') || voice.lang.includes('RU'));
            
            if (russianVoice) utterance.voice = russianVoice;
            speechSynthesis.speak(utterance);
        }

        function speakCountdown(seconds) {
            if (seconds > 0 && seconds <= 5) speak(seconds.toString());
        }

        function speakExerciseStart() {
            if (currentPhase === 'work') {
                speak(`–ù–∞—á–∏–Ω–∞–µ–º ${exercises[currentExerciseIndex]}`);
            } else if (currentPhase === 'rest') {
                if (currentExerciseIndex === exercises.length - 1) {
                    speak("–û—Ç–¥—ã—Ö –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –∫—Ä—É–≥–æ–º");
                } else {
                    speak("–û—Ç–¥—ã—Ö");
                }
            } else if (currentPhase === 'circleRest') {
                speak("–û—Ç–¥—ã—Ö –º–µ–∂–¥—É –∫—Ä—É–≥–∞–º–∏");
            }
        }

        // ================= –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–´–ô –†–ï–ñ–ò–ú =================
        function toggleFullscreen() {
            if (!isFullscreen) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        }

        function enterFullscreen() {
            const element = document.documentElement;
            if (element.requestFullscreen) element.requestFullscreen();
            else if (element.mozRequestFullScreen) element.mozRequestFullScreen();
            else if (element.webkitRequestFullscreen) element.webkitRequestFullscreen();
            else if (element.msRequestFullscreen) element.msRequestFullscreen();
        }

        function exitFullscreen() {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            else if (document.msExitFullscreen) document.msExitFullscreen();
        }

        function updateFullscreenButton() {
            const fullscreenElement = document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.mozFullScreenElement || 
                document.msFullscreenElement;
            isFullscreen = !!fullscreenElement;
            
            if (isFullscreen) {
                fullscreenBtn.innerHTML = '‚õ∂';
                fullscreenBtn.title = '–í—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞';
                document.body.classList.add('fullscreen');
            } else {
                fullscreenBtn.innerHTML = '‚õ∂';
                fullscreenBtn.title = '–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º';
                document.body.classList.remove('fullscreen');
            }
        }

        // ================= –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô =================
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && isFullscreen) setTimeout(updateFullscreenButton, 100);
            
            if (e.code === 'Space') {
                e.preventDefault();
                if (isRunning) togglePause(); else startWorkout();
            }
            
            if (e.code === 'KeyR' && e.ctrlKey) {
                e.preventDefault();
                resetWorkout();
            }
            
            if (e.code === 'KeyF') {
                e.preventDefault();
                toggleFullscreen();
            }
        });

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
        document.addEventListener('visibilitychange', async () => {
            console.log('[DEBUG] –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏:', document.visibilityState);
            
            if (document.visibilityState === 'visible' && isRunning && !isPaused) {
                console.log('[DEBUG] –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —ç–∫—Ä–∞–Ω–∞...');
                try {
                    await requestWakeLock();
                } catch (err) {
                    console.error('[DEBUG] –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —ç–∫—Ä–∞–Ω–∞:', err);
                }
            }
        });

        // ================= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =================
        window.addEventListener('DOMContentLoaded', init);
        
        speechSynthesis.getVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = () => {
                console.log('[DEBUG] –ì–æ–ª–æ—Å–∞ TTS –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            };
        }
        
        window.addEventListener('beforeunload', () => {
            console.log('[DEBUG] –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
            if (wakeLock !== null) wakeLock.release();
            if (mouseKeepAliveInterval) clearInterval(mouseKeepAliveInterval);
        });
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        console.log('========================================');
        console.log('–°–¢–ê–¢–£–° –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:');
        console.log('–ü—Ä–æ—Ç–æ–∫–æ–ª:', window.location.protocol);
        console.log('–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç?', window.isSecureContext);
        console.log('Wake Lock –¥–æ—Å—Ç—É–ø–µ–Ω?', wakeLockSupported);
        console.log('Hostname:', window.location.hostname);
        console.log('========================================');
    </script>
</body>
</html>